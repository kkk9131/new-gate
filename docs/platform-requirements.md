# プラットフォーム要件定義書

## 📋 ドキュメント情報
- **作成日**: 2025-11-09
- **バージョン**: 2.0
- **対象**: 新時代SaaS プラットフォーム全体
- **目的**: プラグインアーキテクチャによる拡張可能なSaaSプラットフォームの構築

---

## 🎯 プロジェクト概要

### ビジョン

**「ユーザーに合わせて無限に進化するSaaSプラットフォーム」**

従来のSaaSは機能が固定されているため、ユーザーのニーズに完全にフィットしないことが多い。
新時代SaaSは、**プラグインアーキテクチャ**により、ユーザーが必要な機能だけを選んでインストールできる柔軟なプラットフォームを目指す。

### コアコンセプト

```yaml
3つの柱:
  1. Desktop OS風UI:
     - ウィンドウシステムで複数アプリを同時操作
     - ドラッグ&ドロップで直感的な操作
     - 4分割モードで効率的なマルチタスク

  2. プラグインエコシステム:
     - 開発者がアプリ（プラグイン）を開発・公開
     - ユーザーがストアから必要な機能をダウンロード
     - プラグイン同士が連携して強力なワークフローを構築

  3. AIエージェント自動化:
     - 繰り返し作業を自動化
     - 複数プラグインを横断したタスク実行
     - スケジューリングによる定期実行
```

---

## 🏗️ システムアーキテクチャ

### 全体構成

```
┌────────────────────────────────────────────────────┐
│              Desktop UI Layer                       │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ Plugin 1 │ │ Plugin 2 │ │ Plugin N │ ← ユーザー │
│  │ Window   │ │ Window   │ │ Window   │   選択    │
│  └────┬─────┘ └────┬─────┘ └────┬─────┘           │
└───────┼────────────┼────────────┼─────────────────┘
        │            │            │
┌───────▼────────────▼────────────▼─────────────────┐
│           Plugin Runtime Layer                     │
│  - Sandbox実行環境                                 │
│  - 権限管理                                        │
│  - プラグイン間通信                                │
└───────┬────────────────────────────────────────────┘
        │
┌───────▼────────────────────────────────────────────┐
│              Core API Layer                        │
│  ┌─────────┐ ┌─────────┐ ┌──────────┐            │
│  │ Auth    │ │ Storage │ │ Agent    │            │
│  │ API     │ │ API     │ │ Executor │            │
│  └─────────┘ └─────────┘ └──────────┘            │
└───────┬────────────────────────────────────────────┘
        │
┌───────▼────────────────────────────────────────────┐
│            Infrastructure Layer                    │
│  - Supabase (DB + Auth)                           │
│  - Vercel (Hosting)                               │
│  - OpenAI (AI Agent)                              │
└────────────────────────────────────────────────────┘
```

### レイヤー責務

#### 1. Desktop UI Layer
- ウィンドウ管理（開く/閉じる/リサイズ/移動）
- アプリアイコングリッド表示
- 4分割モード切替
- ChatPanelインターフェース

#### 2. Plugin Runtime Layer
- プラグインのサンドボックス実行
- 権限チェック（ストレージ、API、他プラグイン連携）
- プラグイン間メッセージング
- ライフサイクル管理（install/activate/deactivate/uninstall）

#### 3. Core API Layer
- **Auth API**: ユーザー認証・権限管理
- **Storage API**: データ保存・取得
- **UI API**: ウィンドウ操作・通知表示
- **Agent API**: タスク実行・スケジューリング
- **Plugin API**: プラグイン情報取得・インストール管理

#### 4. Infrastructure Layer
- データベース（Supabase PostgreSQL）
- 認証（Supabase Auth）
- ホスティング（Vercel）
- AI処理（OpenAI API）

---

## 📦 機能要件

### フェーズ1: コアプラットフォーム（MVP）

#### 1.1 Desktop UI基盤
- ✅ Window管理システム
- ✅ AppIconグリッド（ドラッグ&ドロップ）
- ✅ ChatPanel（リサイズ可能）
- ✅ 4分割モード
- ✅ 状態永続化（localStorage）

#### 1.2 デフォルトアプリ（プラグイン化）
以下の基本機能をプラグインとして実装：

**Projects App** - プロジェクト管理
- プロジェクト作成・編集・削除
- ステータス管理（進行中/完了/保留）
- 予算管理

**Settings App** - 設定管理
- ユーザー設定（表示名、言語、テーマ）
- アプリ設定（通貨、会計年度、税率）

**Revenue App** - 売上確認
- 売上登録・編集・削除
- 期間別集計（日次/月次/年次）
- プロジェクト別集計

#### 1.3 認証システム
- Supabase Auth統合
- JWT認証
- Row Level Security (RLS)

#### 1.4 Core API実装
- `/api/auth/*` - 認証関連
- `/api/storage/*` - データストレージ
- `/api/ui/*` - UI操作
- デフォルトアプリ用API（`/api/projects/*`, `/api/revenues/*`, etc.）

---

### フェーズ2: プラグインシステム

#### 2.1 プラグイン基盤
- プラグインマニフェスト定義（plugin.json）
- プラグインローダー実装
- サンドボックス実行環境
- 権限管理システム

#### 2.2 プラグインストア
- ストアUI（検索・フィルタリング）
- プラグイン詳細ページ
- インストール/アンインストール
- プラグイン評価・レビューシステム

#### 2.3 開発者向け機能
- プラグイン開発SDK
- ローカルデバッグ環境
- プラグイン公開フロー
- ドキュメント・チュートリアル

#### 2.4 プラグインAPI
- `/api/plugins/*` - プラグイン情報取得
- `/api/store/*` - ストア機能（検索/インストール）
- `/api/permissions/*` - 権限管理

---

### フェーズ3: AIエージェント自動化

#### 3.1 エージェント実行エンジン
- タスク定義（YAML/JSON）
- ワークフロー実行エンジン
- エラーハンドリング・リトライ
- 実行履歴管理

#### 3.2 スケジューラー
- 定期実行（cron形式）
- イベントトリガー実行
- 手動実行

#### 3.3 タスク管理UI
- タスク一覧・詳細表示
- 実行ログ確認
- タスク作成・編集

#### 3.4 エージェントAPI
- `/api/agents/tasks/*` - タスク管理
- `/api/agents/workflows/*` - ワークフロー定義
- `/api/agents/execute/*` - 実行トリガー
- `/api/agents/logs/*` - ログ取得

---

## 🔐 非機能要件

### セキュリティ

#### プラグインセキュリティ
- **サンドボックス実行**: プラグインは隔離環境で実行
- **権限システム**: 明示的な権限付与が必要
  - `storage.read`, `storage.write`
  - `ui.window`, `ui.notification`
  - `plugin.communication`
  - `agent.execute`
- **コード検証**: 公開前のセキュリティスキャン
- **レート制限**: API呼び出し制限

#### データセキュリティ
- Row Level Security (RLS) 全テーブル有効化
- JWT認証
- HTTPS通信
- XSS/CSRF対策

### パフォーマンス
- 初期ロード: 3秒以内
- プラグインインストール: 5秒以内
- API応答時間: 200ms以内
- Lighthouse スコア: 80+

### スケーラビリティ
- ユーザー数: 10,000+対応
- 同時接続: 1,000+対応
- プラグイン数: 1,000+登録可能
- データベース: 100GB+対応

### 可用性
- アップタイム: 99.9%
- 自動バックアップ（日次）
- エラー監視・アラート
- グレースフルデグラデーション

---

## 🎨 UI/UX設計原則

### デザイン原則
1. **直感的操作**: ドラッグ&ドロップで誰でも使える
2. **カスタマイズ性**: ユーザーが自由にアプリを配置
3. **一貫性**: 全プラグインで統一されたUI/UX
4. **レスポンシブ**: デスクトップ最適化、将来モバイル対応
5. **アクセシビリティ**: WCAG 2.1 AA準拠（将来）

### ユーザーフロー

#### 初回利用
```
1. サインアップ/ログイン
   ↓
2. デスクトップ画面表示（デフォルトアプリ3つ）
   ↓
3. オンボーディング（基本操作説明）
   ↓
4. ストアアイコンをクリック
   ↓
5. 必要なプラグインを検索・インストール
   ↓
6. インストールしたアプリがデスクトップに追加
```

#### 日常利用
```
1. デスクトップでアプリアイコンをダブルクリック
   ↓
2. ウィンドウが開く
   ↓
3. 複数ウィンドウを並べて作業
   ↓
4. 必要に応じて4分割モードで効率化
   ↓
5. ChatPanelでAIアシスタントに相談
```

---

## 🔌 プラグインエコシステム

### プラグインカテゴリ

```yaml
ビジネス管理:
  - CRM（顧客管理）
  - 見積・請求書作成
  - 在庫管理
  - タイムトラッキング

コミュニケーション:
  - メール送信
  - チャットツール連携（Slack, Discord）
  - カレンダー統合

データ分析:
  - ダッシュボード
  - レポート生成
  - データビジュアライゼーション

開発ツール:
  - Git連携
  - デプロイツール
  - APIテスター

ユーティリティ:
  - メモ・ノート
  - タスク管理
  - ファイルマネージャー
```

### プラグイン開発フロー

```
1. SDK取得・環境構築
   ↓
2. ローカル開発（plugin.json + コンポーネント実装）
   ↓
3. ローカルテスト（Dev Mode）
   ↓
4. セキュリティスキャン
   ↓
5. ストアへ公開申請
   ↓
6. レビュー・承認
   ↓
7. ストアに掲載
```

---

## 🤖 AIエージェント活用例

### ユースケース

#### 1. 定期レポート自動生成
```yaml
タスク名: 月次売上レポート作成
スケジュール: 毎月1日 9:00
ワークフロー:
  1. Revenue Appから先月の売上データ取得
  2. データ集計・分析
  3. レポートPDF生成
  4. メールで送信
```

#### 2. プロジェクト進捗通知
```yaml
タスク名: プロジェクト期限アラート
スケジュール: 毎日 18:00
ワークフロー:
  1. Projects Appから進行中プロジェクト取得
  2. 期限が3日以内のプロジェクトを抽出
  3. Slackに通知送信
```

#### 3. データバックアップ
```yaml
タスク名: 毎週データバックアップ
スケジュール: 毎週日曜 2:00
ワークフロー:
  1. 全プラグインデータをエクスポート
  2. ZIP圧縮
  3. クラウドストレージにアップロード
```

---

## 📊 ビジネスモデル（将来構想）

### 収益モデル

```yaml
フリーミアム:
  無料プラン:
    - 基本プラグイン3つまで
    - ストレージ 1GB
    - エージェント実行 月100回

  Proプラン ($19/月):
    - プラグイン無制限
    - ストレージ 50GB
    - エージェント実行 月1000回
    - 優先サポート

  Businessプラン ($49/月):
    - チーム機能
    - ストレージ 500GB
    - エージェント実行 無制限
    - カスタムプラグイン開発サポート

プラグイン販売手数料:
  - 有料プラグイン販売手数料 30%
  - 無料プラグインは手数料なし
```

---

## 🚀 ロードマップ

### Phase 1: MVP (3ヶ月)
- Desktop UI基盤
- デフォルトアプリ3つ（Projects, Settings, Revenue）
- 認証システム
- Core API実装

### Phase 2: プラグインシステム (3ヶ月)
- プラグインローダー
- プラグインストア
- 開発者SDK
- 初期プラグイン5-10個

### Phase 3: エージェント自動化 (2ヶ月)
- エージェント実行エンジン
- スケジューラー
- タスク管理UI

### Phase 4: エコシステム拡大 (継続)
- プラグイン開発コミュニティ育成
- ドキュメント・チュートリアル充実
- パートナープログラム
- 有料プラン導入

---

## 📚 関連ドキュメント

- [MVP要件定義書](./mvp-requirements.md) - 最初のリリース仕様
- [プラグインアーキテクチャ設計](./plugin-architecture.md) - プラグインシステム詳細
- [開発者ガイド](./developer-guide.md) - プラグイン開発手順
- [プラグインストア設計](./plugin-store-design.md) - ストアUI仕様
- [エージェントシステム設計](./agent-system-design.md) - 自動化エンジン仕様
- [Core API仕様](./core-api-spec.md) - プラグインが使用するAPI
- [データベーススキーマ](./database-schema.md) - DB設計
- [Desktop UI設計](./desktop-ui-design.md) - UI詳細仕様
- [API設計書](./api-design.md) - 全API仕様
- [実装タスクリスト](./tasks.md) - 開発計画

---

## 🎯 成功指標（KPI）

### プラットフォーム指標
- アクティブユーザー数: 1,000+ (6ヶ月)
- プラグイン登録数: 50+ (6ヶ月)
- プラグイン開発者数: 20+ (6ヶ月)

### ユーザーエンゲージメント
- 週次アクティブユーザー: 70%+
- プラグインインストール数/ユーザー: 5+
- エージェント実行回数/ユーザー: 10+/月

### ビジネス指標（将来）
- 有料プラン転換率: 5%+
- 月次収益成長率: 20%+
- チャーン率: 5%以下
