# マルチエージェントチャット UI 要件定義

## 📋 ドキュメント情報
- **作成日**: 2025-11-15
- **バージョン**: 0.1
- **対象**: チャットUI・4分割画面連携
- **目的**: チャット表示/操作フローと既存分割画面の統合仕様を明確化

---

## 🖥️ 全体レイアウト
- 既存の4画面分割レイアウトは維持。チャットUIは**ヘッダー右側に追加するAIボタン**（`AI`）から展開する。
- AIボタン押下で画面右側にChatGPT/Cursor風のチャットペインがスライドイン。**約200msのスライド＋フェードアニメーション**で開閉し、既存ワークスペース側は自動でリサイズされ、チャットと重ならない。
- チャットペイン幅は初期 420px。右境界をドラッグ＆ドロップして240px〜640pxの範囲で変更可能。幅はユーザーごとにローカル保存。

```
┌───────────────────────────────────────────┬──────────────┐
│  Header: [Logo] SaaS .... [AI]                              │ ユーザ │
├───────────────────────────────────────────┼──────────────┤
│  4分割/ウィンドウ領域（チャット展開時は自動リサイズ）    │ チャット │
│                                                       │ ペイン   │
└───────────────────────────────────────────┴──────────────┘
```

---

## 💬 チャットペインの詳細
1. **表示モード**: デフォルトは閉じた状態。`AI`ボタンで開閉。Escキー長押しでチャット閉鎖。
2. **セッションタブ**: 画面1〜4のタスクに対応するチャットタブを上部に配置（`Screen1`, `Screen2`...）。同時並列時でもタブを切り替えて各画面専用のチャット履歴を閲覧できる。**将来的に5画面以上へ拡張するため、横スクロールや折り返し表示に対応する設計**とする。
3. **タスク状態表示**: メッセージログ上部にステータスインジケータを表示。
   - 例: `🔧 Tool実行中`, `🧠 推論中`, `📡 MCP:files.read`, `⏹ 停止済み`
   - 背景は軽いグラデーションで視認性向上。
4. **停止操作**: チャットペイン最上部に`Stop (Esc)`ボタン。Escキー押下でも同等のキャンセルAPIを叩きタスクを即時停止。
5. **キーボード**: `Cmd/Ctrl + Enter`送信、`Esc`で停止、`Shift + Esc`でチャット閉じる。

---

## 🪟 4画面との連携
- 画面はすでに分割実装済み。チャットと干渉しないよう**右側チャット分だけ各スクリーンの幅を再計算**する。
- 各スクリーンの縁（border）にChatGPT Atlas風のパルスアニメーションを付与。
  - タスク実行中: **エメラルドグリーン**のグラデーションがゆっくり周回。
  - 待機中: グレイの静的ライン。
  - エラー: 赤色の脈動。
- スクリーン選択UI: チャット内タブに加えてヘッダー近くに`Screen1`〜`Screen4`のピル型ボタンを並べ、選択すると対応する画面がハイライト（ボーダー太さ+影）される。

---

## ⚙️ ステータス・フィードバック
- **タスク実行中パネル**: チャットログ直下にカードを表示し、実行中のアクションを逐次更新。
  - 表示例: `Step 2/5 | Tool: browser.open | MCP:github.search`
  - 状態テキストはアニメーション付きドットで進行感を演出。
- **ESC停止時**: 画面縁アニメーションを即座にグレーに戻し、チャットに「⏹ ユーザーがEscで停止」を投稿。
- **安心感強化**: 実行中のAIがどのツール/モデル/APIキーを使っているかをミニログで表示し（例: `Model: gpt-4.1 | Key: team-prod`）、ユーザーが制御感を得られるようにする。

---

## ⌨️ クイックアクション（スペースキー）
- デスクトップ状態でスペースキーを押すと、**画面右下**に小型インプット（幅560px・高さ56px）がポップアップ。既存ショートカットとの競合はなく、いつでも呼び出し可能。
- 入力完了後Enterで即タスク化し、現在フォーカスしているスクリーンに割り当て。
- Escでポップアップ閉鎖。入力欄は将来的な音声入力拡張のためマイクボタンをダミー表示。
- 音声対応の将来像: スペースキー長押しで音声録音→STT→同ポップアップに転記するワークフローを実装予定。

---

## 🔄 チャットとスクリーンの同期
- 各スクリーンIDとチャットセッションIDを1:1で紐付け。チャット内で`Screen3`を選択すると、該当スクリーンがハイライトし、ショートカット `Ctrl + 3` でも同様に切替可能。
- スクリーン側でタスクを閉じた場合、チャットもアーカイブ状態へ遷移し履歴のみ閲覧可能。

---

## 🧱 UIコンポーネント要約
| コンポーネント | 仕様 | 備考 |
|----------------|------|------|
| AIボタン | Header右側、プライマリ配色 | トグルでチャット開閉 |
| チャットペイン | 右固定スライド、ドラッグリサイズ | min 240px / max 640px |
| スクリーンタブ | Screen1〜4、バッジでステータス表示 | 並列チャット閲覧 |
| ステータスチップ | Tool/MCP/推論状態を表示 | カラーリング規定 |
| Stopボタン | Esc連動、タスク中断API | 上部固定 |
| Quick Actionバー | スペースで出現、即タスク起動 | 将来マイクボタン有効化 |
| Borderアニメ | Atlas風パルス | 状態別3種 |

---

## ✅ 未決事項 / 次アクション
1. チャットペインのアニメーション（Easing, Duration）詳細。
2. WebRTCプレビューをチャット側にピクチャー・イン・ピクチャーで映すか検討。
3. Quick ActionバーのAPI連携・入力補完仕様を確定。
